<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">
    <title>WebMidi testing</title>



    <script>

        let log = function () {
            for (var i = 0; i < arguments.length; i++) {
                document.body.innerHTML += arguments[i] + ' ';
            }
            document.body.innerHTML+= '<br/>';
        }


        var outputport;
        var inputport;

        let addforwarder = function (in_p, out_p) {
            in_p.onmidimessage = (msg) => {
                log(msg);
                if (out_p) {
                    out_p.send(msg.data);
                } else {
                    log("no output");
                }
            };

        }




        let statechanged = function (event) {
            let port = event.port;
            //log("ojojo");
            //log(port.id, port.name, port.manufacturer, port.state, port.type);

            // id input midi 1 
            //if (port.id == '0AAD67144EB48105E00228EAF229C8BE36823F210F18910A72857FCC22ED463E' && port.state === 'connected') {
            if (port.type == 'input' && port.state === 'connected' && !inputport) {
                log("add niput port");
                log(port.id, port.name, port.manufacturer, port.state, port.type);
                inputport = port;
                // tiene listener ya ?
                //log(port.onmidimessage);

            }


            //set output    
            //if (port.id == '385B9C24833C60BC6A1DCBB3023226013F670A9D5755E6FCF28F603317530671' && port.state === 'connected') {
            if (port.type == 'output' && port.state === 'connected' && (!outputport || outputport.name == inputport.name)) {
                log("set out port");
                log(port.id, port.name, port.manufacturer, port.state, port.type);
                outputport = port;
                addforwarder(inputport, outputport);
            }

        }

        navigator.requestMIDIAccess().then((access) => {
            access.onstatechange = (event) => {
                statechanged(event);
            };
        });


    </script>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

</head>

<body>
    <h1>WebMidi testing</h1>
</body>

</html>